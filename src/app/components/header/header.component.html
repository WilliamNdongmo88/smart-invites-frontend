<header class="header" *ngIf="isShowHeader">
  <div class="container flex flex-between">

    <!-- Logo -->
    <a routerLink="/" class="logo">
      <img src="img/logo.png" alt="Smart Invite" class="logo-img" />
      <span class="logo-text hide-mobile">Smart Invite</span>
    </a>

    <!-- Desktop Navigation -->
    <nav class="nav hide-mobile" *ngIf="!(isMobile | async)">
      
      <!-- Utilisateur NON connectÃ© -->
      <ng-container *ngIf="!isAuthenticated; else loggedInDesktop">
        <a *ngIf="isMobile | async" (click)="scrollTo('accueil')" class="nav-link">Accueil</a>
        <a (click)="navigateToHome()" class="nav-link">FonctionnalitÃ©s</a>
        <a (click)="navigateToScanner()" class="nav-link nav-link-cursor nav-hover">Scanner</a>
        <!-- <a routerLink="/pricing" class="nav-link">Tarifs</a> -->
        <a routerLink="/contact" class="nav-link">Contact</a>
        <button class="btn btn-primary" (click)="navigateToLogin()">Connexion</button>
      </ng-container>

      <!-- Utilisateur connectÃ© -->
      <ng-template #loggedInDesktop>
        <div class="header-actions">
          <div class="notification-icon" role="button" (click)="openNotifications()">
            ðŸ””
            <span class="notification-badge" *ngIf="unreadNotifications > 0">
              {{ unreadNotifications }}
            </span>
          </div>
        </div>
        <span class="welcome" (click)="goToProfile()">Bienvenue, {{ currentUser?.name }} !</span>
        <a *ngIf="isScanning" (click)="scanQrCode()" class="nav-link nav-link-cursor nav-hover">Scanner</a>
        <button class="btns btns-primary" (click)="logout()">DÃ©connexion</button>
      </ng-template>

    </nav>

    <!-- Mobile Menu Button -->
    <div *ngIf="isMobile | async" class="header-actions">
      <div *ngIf="isAuthenticated" class="notification-icon" role="button" (click)="openNotifications()">
        ðŸ””
        <span class="notification-badge" *ngIf="unreadNotifications > 0">
          {{ unreadNotifications }}
        </span>
      </div>
    </div>
    <button class="mobile-menu-btn show-mobile" (click)="toggleMobileMenu()">
      <span *ngIf="!mobileMenuOpen()">â˜°</span>
      <span *ngIf="mobileMenuOpen()">âœ•</span>
    </button>
  </div>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav show-mobile" *ngIf="mobileMenuOpen() && isMobile">

    <!-- Utilisateur NON connectÃ© -->
    <ng-container *ngIf="!isAuthenticated; else loggedInMobile">
      <a (click)="scrollTo('accueil')" class="mobile-nav-link" (click)="toggleMobileMenu(false)">Accueil</a>
      <a (click)="navigateToHome()" class="mobile-nav-link" (click)="toggleMobileMenu(false)">FonctionnalitÃ©s</a>
      <a (click)="navigateToScanner()" class="mobile-nav-link" (click)="toggleMobileMenu(false)">Scanner</a>
      <!-- <a routerLink="/pricing" class="mobile-nav-link" (click)="toggleMobileMenu(false)">Tarifs</a> -->
      <a routerLink="/contact" class="mobile-nav-link" (click)="toggleMobileMenu(false)">Contact</a>
      <button class="btn btn-primary w-100" (click)="navigateToLogin(); toggleMobileMenu(false)">Connexion</button>
    </ng-container>

    <!-- Utilisateur connectÃ© -->
    <ng-template #loggedInMobile>
      <a *ngIf="isScanning" (click)="scanQrCode(); toggleMobileMenu(false)" class="mobile-nav-link nav-hover">Scanner</a>
      <p class="mobile-nav-link welcome" (click)="goToProfile()">Bienvenue, {{ currentUser?.name }}!</p>
      <button class="btns btns-primary w-100" (click)="logout(); toggleMobileMenu(false)">DÃ©connexion</button>
    </ng-template>

  </nav>
</header>

<!-- Notifications Panel -->
<div *ngIf="showNotifications()" class="notifications-panel">
  <div class="notifications-header">
    <h2>Notifications</h2>
    <button class="close-btn" (click)="closeNotifications()">âœ•</button>
  </div>

  <div class="notifications-list">
    <div *ngFor="let notification of notifications"
        class="notification-item"
        (click)="!isSwiping && markAsRead(notification)"
        [class.notif-read]="notification.is_read"
        (touchstart)="startTouch($event, notification)"
        (touchmove)="moveTouch($event, notification)"
        (touchend)="endTouch($event, notification)">
        
      <div class="notification-icon-panel">
        {{ getNotificationIcon(notification.type) }}
      </div>
      <div class="notification-content">
        <p class="notification-title">{{ notification.title }}</p>
        <p class="notification-message">{{ notification.message }}</p>
        <p class="notification-date">{{ formatDate(notification.date) }}</p>
      </div>
      <div class="icon">
        <button class="mark-read" (click)="markAsRead(notification)" *ngIf="!notification.is_read">
          <span>âœ“</span>
        </button>
        <button class="mark-read" (click)="markAsReadAndDelete(notification)">
          <span>âœ•</span>
        </button>
      </div>
    </div>
  </div>


  <div *ngIf="notifications.length === 0" class="no-notifications">
    <p>Aucune notification</p>
  </div>
</div>
<!-- Notification conditionnelle -->
<app-conditional-alert [config]="alertConfig"></app-conditional-alert>