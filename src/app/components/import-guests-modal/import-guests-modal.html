<div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeModal()">‚úï</button>

    <!-- Step 1: Upload -->
    <div *ngIf="currentStep() === 'upload'" class="modal-body">
        <div class="modal-header">
        <h2>Importer des invit√©s</h2>
        <p>T√©l√©chargez un fichier CSV ou Excel avec vos invit√©s</p>
        </div>

        <!-- File Upload Area -->
        <div class="upload-area" (click)="fileInput.click()" [class.dragover]="isDragOver()">
        <input
            #fileInput
            type="file"
            accept=".csv,.xlsx,.xls"
            (change)="onFileSelected($event)"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
            hidden
        />

        <div class="upload-content">
            <div class="upload-icon">üìÅ</div>
            <p class="upload-title">Glissez-d√©posez votre fichier ici</p>
            <p class="upload-subtitle">ou cliquez pour s√©lectionner</p>
            <p class="upload-formats">Formats accept√©s: CSV, XLSX, XLS</p>
        </div>
        </div>

        <!-- File Info -->
        <div *ngIf="selectedFile() as file" class="file-info">
        <p class="file-name">üìÑ {{ file.name }}</p>
        <p class="file-size">{{ formatFileSize(file.size) }}</p>
        </div>

        <!-- Template Download -->
        <div class="template-section">
        <p class="template-label">Besoin d'aide ?</p>
        <button type="button" class="btn btn-outline" (click)="downloadTemplate()">
            üìã T√©l√©charger le mod√®le CSV
        </button>
        </div>

        <!-- Actions -->
        <div class="modal-actions">
        <button type="button" class="btn btn-outline" (click)="closeModal()">
            Annuler
        </button>
        <button
            type="button"
            class="btn btn-primary"
            (click)="uploadFile()"
            [disabled]="!selectedFile() || isLoading"
        >
            {{ isLoading ? '‚è≥ Chargement...' : 'üì§ Continuer' }}
        </button>
        </div>
    </div>

    <!-- Step 2: Preview -->
    <div *ngIf="currentStep() === 'preview'" class="modal-body">
        <div class="modal-header">
            <h2>Aper√ßu des invit√©s</h2>
            <p>{{ importedGuests.length }} invit√©(s) √† importer</p>
        </div>

        <!-- Errors -->
        <div *ngIf="importErrors.length > 0" class="errors-section">
            <p class="errors-title">‚ö†Ô∏è Erreurs trouv√©es:</p>
            <ul class="errors-list">
                <li *ngFor="let error of importErrors">{{ error }}</li>
            </ul>
        </div>

        <app-error-modal
            [visible]="showErrorModal"
            [message]="errorMessage"
            (closed)="closeErrorModal()">
        </app-error-modal>

        <!-- Preview Table -->
        <div class="preview-table">
            <table>
                <thead>
                <tr>
                    <th>Id-√âv√®nement</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>T√©l√©phone</th>
                    <th>Status-RSVP</th>
                    <th>+1</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let guest of paginatedGuests()">
                    <td>{{ guest.eventid }}</td>
                    <td>{{ guest.nom }}</td>
                    <td>{{ guest.email }}</td>
                    <td>{{ guest.phone || '-' }}</td>
                    <td>{{ guest.rsvpstatus || '-' }}</td>
                    <td>{{ guest.plusone }}</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        <div class="pagination">
            <button 
                (click)="prevPage()" 
                [disabled]="currentPage === 1"
                class="page-btn">
                ‚óÄ
            </button>

            <button 
                *ngFor="let page of totalPagesArray()" 
                (click)="goToPage(page)"
                [class.active]="page === currentPage"
                class="page-btn">
                {{ page }}
            </button>

            <button 
                (click)="nextPage()" 
                [disabled]="currentPage === totalPages"
                class="page-btn">
                ‚ñ∂
            </button>
        </div>

        <!-- Actions -->
        <div class="modal-actions">
            <button type="button" class="btn btn-outline" (click)="goBack()">
                ‚Üê Retour
            </button>
            <button
                type="button"
                class="btn btn-primary"
                (click)="confirmImport()"
                [disabled]="importedGuests.length === 0 || isLoading"
            >
                {{ isLoading ? '‚è≥ Importation...' : '‚úì Importer' }}
            </button>
        </div>
        <!-- Indicateur de chargement -->
        <app-spinner [isLoading]="isModalLoading"></app-spinner>
    </div>

    <!-- Step 3: Success -->
    <div *ngIf="currentStep() === 'success'" class="modal-body success-body">
        <div class="success-icon">‚úì</div>
        <h2>Importation r√©ussie !</h2>
        <p class="success-message">
        {{ importedGuests.length }} invit√©(s) ont √©t√© ajout√©s avec succ√®s
        </p>

        <div class="success-stats">
        <div class="stat">
            <span class="stat-value">{{ importedGuests.length }}</span>
            <span class="stat-label">Invit√©s import√©s</span>
        </div>
        </div>

        <button type="button" class="btn btn-primary" style="width: 100%;" (click)="closeModal()">
        ‚úì Fermer
        </button>
    </div>
    </div>
</div>