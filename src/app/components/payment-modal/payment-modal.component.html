<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="isOpen" (click)="closeModal()">
    <!-- Modal Content -->
    <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Close Button -->
    <button class="close-btn" (click)="closeModal()">‚úï</button>

    <!-- Modal Header -->
    <div class="modal-header">
        <h2>Finaliser votre abonnement</h2>
        <p class="subtitle">{{ selectedPlan?.name }} - {{ selectedPlan?.price }} XAF {{ selectedPlan?.period }}</p>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
        <!-- Step Indicator -->
        <div class="step-indicator">
        <div class="step" [class.active]="currentStep() === 1" [class.completed]="currentStep() > 1">
            <span class="step-number">1</span>
            <span class="step-label">Paiement</span>
        </div>
        <div class="step-line" [class.completed]="currentStep() > 1"></div>
        <div class="step" [class.active]="currentStep() === 2" [class.completed]="currentStep() > 2">
            <span class="step-number">2</span>
            <span class="step-label">Preuve</span>
        </div>
        <div class="step-line" [class.completed]="currentStep() > 2"></div>
        <div class="step" [class.active]="currentStep() === 3">
            <span class="step-number">3</span>
            <span class="step-label">Confirmation</span>
        </div>
        </div>

        <!-- Step 1: Payment Instructions -->
        <div class="step-content" *ngIf="currentStep() === 1">
        <!-- Warning Alert -->
        <div class="alert alert-info">
            <span class="alert-icon">‚ÑπÔ∏è</span>
            <div>
            <p class="alert-title">Modes de paiement automatique en d√©veloppement</p>
            <p class="alert-message">
                Les paiements en ligne via Orange Money, MTN Money et d'autres moyens de paiement √©lectronique
                seront bient√¥t disponibles. Pour le moment, veuillez effectuer le paiement manuellement.
            </p>
            </div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-methods">
            <h3>Modes de paiement disponibles</h3>

            <!-- Orange Money -->
            <div class="payment-method-card">
            <div class="method-header">
                <span class="method-icon">üì±</span>
                <h4>Orange Money</h4>
                <span class="badge badge-primary">Recommand√©</span>
            </div>
            <div class="method-details">
                <p class="method-label">Num√©ro de compte Orange Money :</p>
                <div class="account-number">
                <span class="number">{{ owner.orangeMoneyNumber }}</span>
                <button class="copy-btn" (click)="copyToClipboard(owner.orangeMoneyNumber)">
                    {{ copiedOrange ? '‚úì Copi√©' : 'üìã Copier' }}
                </button>
                </div>
                <p class="method-instruction">
                Envoyez <strong>{{ selectedPlan?.price }} XAF {{ selectedPlan?.period }}</strong> √† ce num√©ro
                </p>
            </div>
            </div>

            <!-- MTN Money -->
            <div class="payment-method-card">
            <div class="method-header">
                <span class="method-icon">üì±</span>
                <h4>MTN Money</h4>
            </div>
            <div class="method-details">
                <p class="method-label">Num√©ro de compte MTN Money :</p>
                <div class="account-number">
                <span class="number">{{ owner.mtnMoneyNumber }}</span>
                <button class="copy-btn" (click)="copyToClipboard(owner.mtnMoneyNumber)">
                    {{ copiedMtn ? '‚úì Copi√©' : 'üìã Copier' }}
                </button>
                </div>
                <p class="method-instruction">
                Envoyez <strong>{{ selectedPlan?.price }} XAF {{ selectedPlan?.period }}</strong> √† ce num√©ro
                </p>
            </div>
            </div>

            <!-- Virement Bancaire -->
            <div class="payment-method-card">
            <div class="method-header">
                <span class="method-icon">üè¶</span>
                <h4>Virement Bancaire</h4>
            </div>
            <div class="method-details">
                <p class="method-label">D√©tails du compte bancaire :</p>
                <div class="bank-details">
                <div class="detail-row">
                    <span class="detail-label">Titulaire :</span>
                    <span class="detail-value">{{owner.name}}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">IBAN :</span>
                    <span class="detail-value">{{owner.iban}}</span>
                </div>
                <!-- <div class="detail-row">
                    <span class="detail-label">BIC :</span>
                    <span class="detail-value">BNPAFRPP</span>
                </div> -->
                </div>
            </div>
            </div>
        </div>

        <!-- Important Notice -->
        <div class="alert alert-warning">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div>
            <p class="alert-title">Important</p>
            <p class="alert-message">
                Apr√®s avoir effectu√© le paiement, vous devez t√©l√©charger la capture d'√©cran comme preuve
                pour que votre forfait soit activ√© rapidement.
            </p>
            </div>
        </div>

        <!-- Next Button -->
        <div class="modal-actions">
            <button class="btn btn-outline" (click)="closeModal()">Annuler</button>
            <button class="btn btn-primary" (click)="nextStep()">
            J'ai effectu√© le paiement ‚Üí
            </button>
        </div>
        </div>

        <!-- Step 2: Upload Proof -->
        <div class="step-content" *ngIf="currentStep() === 2">
        <div class="alert alert-success">
            <span class="alert-icon">‚úì</span>
            <div>
            <p class="alert-title">T√©l√©chargez votre preuve de paiement</p>
            <p class="alert-message">
                T√©l√©chargez une capture d'√©cran de votre paiement (re√ßu, confirmation, etc.)
                pour que nous puissions v√©rifier et activer votre forfait.
            </p>
            </div>
        </div>

        <!-- File Upload Area -->
        <div class="upload-section">
            <div
                class="upload-area"
                [class.dragover]="isDragOver"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave()"
                (drop)="onDrop($event)"
            >
                <span class="upload-icon">üì§</span>
                <p class="upload-title">Glissez-d√©posez votre capture d'√©cran ici</p>
                <p class="upload-subtitle">ou</p>
                <label class="upload-btn">
                    Parcourir les fichiers
                    <input
                    type="file"
                    accept="image/*,.pdf"
                    (change)="onFileSelected($event)"
                    style="display: none"
                    />
                </label>
                <p class="upload-info">
                    Format accept√© : JPG, PNG, PDF (max 5 MB)
                </p>
            </div>

            <!-- File Preview -->
            <div *ngIf="paymentProof" class="file-preview">
            <div class="preview-header">
                <span class="preview-icon">‚úì</span>
                <div class="preview-info">
                <p class="preview-name">{{ paymentProof.fileName }}</p>
                <p class="preview-meta">{{ paymentProof.fileSize }} ‚Ä¢ {{ paymentProof.fileType }}</p>
                </div>
                <button class="remove-btn" (click)="removeFile()">‚úï</button>
            </div>
            <img
                *ngIf="paymentProof.fileType.startsWith('image')"
                [src]="paymentProof.base64"
                class="preview-image"
                alt="Preuve de paiement"
            />
            </div>

            <!-- Error Message -->
            <div *ngIf="uploadError" class="alert alert-error">
            <span class="alert-icon">‚úï</span>
            <p>{{ uploadError }}</p>
            </div>
        </div>

        <!-- Activation Timeline -->
        <div class="timeline">
            <h3>D√©lai d'activation</h3>
            <div class="timeline-item">
            <span class="timeline-icon">üì§</span>
            <div class="timeline-content">
                <p class="timeline-title">T√©l√©chargement</p>
                <p class="timeline-desc">Vous √™tes ici</p>
            </div>
            </div>
            <div class="timeline-item">
            <span class="timeline-icon">üëÅÔ∏è</span>
            <div class="timeline-content">
                <p class="timeline-title">V√©rification</p>
                <p class="timeline-desc">Moins de 5 minutes</p>
            </div>
            </div>
            <div class="timeline-item">
            <span class="timeline-icon">‚úì</span>
            <div class="timeline-content">
                <p class="timeline-title">Activation</p>
                <p class="timeline-desc">Forfait actif imm√©diatement</p>
            </div>
            </div>
        </div>

        <!-- Support Info -->
        <div class="support-info">
            <p class="support-title">‚è∞ D√©lai d'activation garanti</p>
            <p class="support-desc">
            Votre forfait sera activ√© en moins de <strong>5 minutes</strong> apr√®s v√©rification de la preuve.
            Si apr√®s ce d√©lai votre forfait n'est toujours pas activ√©, <strong>contactez imm√©diatement</strong>
            notre service client pour une prise en charge prioritaire.
            </p>
            <a [href]="owner.mailto" class="support-link">
            üìß {{mail}}
            </a>
        </div>

        <!-- Next Button -->
        <div class="modal-actions">
            <button class="btn btn-outline" (click)="previousStep()">‚Üê Retour</button>
            <button
            class="btn btn-primary"
            [disabled]="!paymentProof"
            (click)="nextStep()"
            >
            Soumettre la preuve ‚Üí
            </button>
        </div>
        </div>

        <!-- Step 3: Confirmation -->
        <div class="step-content" *ngIf="currentStep() === 3">
        <div class="success-container">
            <div class="success-icon">‚úì</div>
            <h3>Preuve de paiement re√ßue !</h3>
            <p class="success-message">
            Merci d'avoir t√©l√©charg√© votre preuve de paiement.
            </p>

            <!-- Confirmation Details -->
            <div class="confirmation-details">
            <div class="detail-item">
                <span class="detail-icon">üìã</span>
                <div>
                <p class="detail-label">Plan choisi</p>
                <p class="detail-value">{{ selectedPlan?.name }}</p>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-icon">üí∞</span>
                <div>
                <p class="detail-label">Montant</p>
                <p class="detail-value">{{ selectedPlan?.price }} {{ selectedPlan?.period }}</p>
                </div>
            </div>
            <div class="detail-item">
                <span class="detail-icon">üìÑ</span>
                <div>
                <p class="detail-label">Preuve</p>
                <p class="detail-value">{{ paymentProof?.fileName }}</p>
                </div>
            </div>
            </div>

            <!-- Next Steps -->
            <div class="next-steps">
            <h4>Prochaines √©tapes</h4>
            <ol>
                <li>Nous v√©rifions votre preuve de paiement</li>
                <li>Votre forfait est activ√© (moins de 5 minutes)</li>
                <li>Vous recevez une confirmation par email</li>
                <li>Commencez √† utiliser toutes les fonctionnalit√©s</li>
            </ol>
            </div>

            <!-- Support Contact -->
            <div class="support-box">
            <p class="support-title">Besoin d'aide ?</p>
            <p class="support-desc">
                Si vous avez des questions ou si votre forfait n'est pas activ√© apr√®s 5 minutes,
                contactez notre √©quipe support.
            </p>
            <div class="support-contacts">
                <a [href]="owner.mailto" class="contact-link">
                üìß {{mail}}
                </a>
                <a [href]="'tel:' + owner.orangeMoneyNumber" class="contact-link">
                üì± {{owner.orangeMoneyNumber}}
                </a>
            </div>
            </div>

            <!-- Close Button -->
            <div class="modal-actions">
            <button class="btn btn-primary" (click)="closeModal()">
                Fermer et continuer
            </button>
            </div>
        </div>
        </div>
    </div>
    </div>
</div>