<div class="event-detail">
    <!-- Header -->
    <div class="event-header">
        <div class="container">
            <a routerLink="/dashboard" class="back-link">‚Üê Retour au tableau de bord</a>
            <div class="header-content">
            <div>
                <h1>{{ event.title }}</h1>
                <p>Gestion des invitations et des invit√©s</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" (click)="editEvent()">‚úèÔ∏è √âditer</button>
                <button class="btn btn-outline btn-danger" (click)="openDeleteModal('delete')">üóëÔ∏è Supprimer</button>
            </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="container py-12 c-mgtop">
        <div class="grid grid-main">
            <!-- Left column - Event details and guests -->
            <div class="left-column">
                <!-- Event Info Card -->
                <div class="card">
                    <h2>D√©tails de l'√©v√©nement</h2>

                    <div class="details-grid">
                    <div class="detail-item">
                        <p class="detail-label">üìÖ Date et heure</p>
                        <p class="detail-value-date">{{ formatDate(event.date) }}</p>
                        <p class="detail-value-date">{{ event.time }}</p>
                    </div>

                    <div class="detail-item">
                        <p class="detail-label">üìç Lieu</p>
                        <p class="detail-value-location">{{ event.location }}</p>
                    </div>
                    </div>

                    <div class="detail-full">
                    <p class="detail-label">Description</p>
                    <p class="detail-value">{{ event.description }}</p>
                    </div>

                    <div class="divider-gold"></div>

                    <button class="btn btn-primary" style="width: 100%;" (click)="sendInvitations()">
                    G√©rer vos invit√©s
                    </button>
                </div>

                <!-- Guests List -->
                <div *ngIf="!(isMobile | async)" class="card mt-8">
                    <h2 class="clickable-title">
                        Invit√©s ({{ filteredGuests.length }})
                    </h2>

                    <!-- Search and Filter -->
                    <div *ngIf="!(isMobile | async)" class="search-filter">
                        <!-- <div class="search-box">
                            <input
                            type="text"
                            placeholder="Rechercher par nom ou email..."
                            [(ngModel)]="searchTerm"
                            (ngModelChange)="filterGuests()"
                            />
                        </div> -->

                        <div class="filter-buttons">
                            <button
                                *ngFor="let filter of filters"
                                [class.active]="filterStatus() === filter.value"
                                class="filter-btn"
                                (click)="setFilterStatus(filter.value)">
                                {{ getFilterLabel(filter.value) }}
                            </button>
                            <!-- <button class="btn btn-outline filter-btn" style="width: 100%;" (click)="exportCSV()">
                                üìä Exporter en CSV
                            </button> -->
                            <button class=" filter-btn btn-outline" style="width: 100%;" (click)="exportPDF()">
                                üìÑ Exporter en PDF
                            </button>
                            <!-- <button class="btn btn-outline" style="width: 100%;" (click)="exportExcel()">
                                üìà Exporter en Excel
                            </button> -->
                        </div>
                    </div>

                    <!-- Guests Table -->
                    <div *ngIf="!(isMobile | async)" class="guests-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Nom +1</th>
                                    <th>Restrictions</th>
                                    <th>Restrictions +1</th>
                                    <!-- <th>Actions</th> -->
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let guest of paginatedGuests()" [class]="'status-' + guest.status">
                                    <td>{{ guest.name }}</td>
                                    <td class="email">{{ guest.plusOne ? guest.plusOneName : '-' }}</td>
                                    <td class="restrictions">{{ guest.dietaryRestrictions || '-' }}</td>
                                    <td class="restrictions">{{ guest.plusOnedietaryRestrictions || '-' }}</td>
                                    <!-- <td class="actions">
                                    <button class="btn-small" (click)="editGuest(guest)">√âditer</button>
                                    </td> -->
                                    <td>
                                        <span class="status-badge" [class]="'status-' + guest.status">
                                            {{ getStatusIcon(guest.status) }} {{ getStatusLabel(guest.status) }}
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div *ngIf="filteredGuests.length === 0 && isScanning" class="no-guests">
                            <p>Aucun invit√© trouv√©</p>
                        </div>
                        <div *ngIf="filteredGuests.length === 0 && !isScanning" class="no-guests">
                            <p>L'√©v√©nement n'est pas encore pass√©</p>
                        </div>
                    </div>

                    <!-- Pagination Controls -->
                    <div *ngIf="!(isMobile | async)" class="pagination">
                        <button 
                            (click)="prevPage()" 
                            [disabled]="currentPage === 1"
                            class="page-btn">
                            ‚óÄ
                        </button>

                        <button 
                            *ngFor="let page of totalPagesArray()" 
                            (click)="goToPage(page)"
                            [class.active]="page === currentPage"
                            class="page-btn">
                            {{ page }}
                        </button>

                        <button 
                            (click)="nextPage()" 
                            [disabled]="currentPage === totalPages"
                            class="page-btn">
                            ‚ñ∂
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right column - Stats -->
            <div class="right-column">
                <!-- Quick Stats -->
                <div *ngIf="!(isMobile | async)" class="card">
                    <h3>R√©sum√©</h3>

                    <div class="stats-list">
                    <div class="stat-item">
                        <p class="stat-label">Total</p>
                        <p class="stat-value">{{ event.totalGuests }}</p>
                        <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                        </div>
                    </div>

                    <div class="stat-item">
                        <p class="stat-label confirmed">‚úì Confirm√©s</p>
                        <p class="stat-value">{{ event.confirmedGuests }}</p>
                        <div class="progress-bar">
                        <div class="progress-fill confirmed" [style.width.%]="getPercentage(event.confirmedGuests)"></div>
                        </div>
                    </div>

                    <div class="stat-item">
                        <p class="stat-label pending">‚è≥ En attente</p>
                        <p class="stat-value">{{ event.pendingGuests }}</p>
                        <div class="progress-bar">
                        <div class="progress-fill pending" [style.width.%]="getPercentage(event.pendingGuests)"></div>
                        </div>
                    </div>

                    <div class="stat-item">
                        <p class="stat-label declined">‚úï Refus√©s</p>
                        <p class="stat-value">{{ event.declinedGuests }}</p>
                        <div class="progress-bar">
                        <div class="progress-fill declined" [style.width.%]="getPercentage(event.declinedGuests)"></div>
                        </div>
                    </div>
                    </div>

                    <div class="divider-gold"></div>

                    <div class="response-rate">
                    <p class="label">Taux de r√©ponse</p>
                    <p class="value">{{ getResponseRate() }}%</p>
                    </div>
                </div>

                <!-- Actions üë§-->
                <div class="card mt-6">
                    <h3>Actions rapides</h3>
                    <div class="actions-list">
                    <button class="btn btn-outline" style="width: 100%;" (click)="openAddGuestModal()">
                        ‚ûï Ajouter un invit√©
                    </button>
                    <button class="btn btn-outline" style="width: 100%;" (click)="openImportModal()">
                        üì• Importer une liste d'invit√©
                    </button>
                    <!-- <button class="btn btn-primary" style="width: 100%;" (click)="sendReminder()">
                        ‚úâÔ∏è Envoyer rappel
                    </button> -->
                    </div>
                </div>

                <!-- Export Options -->
                <div *ngIf="!(isMobile | async)" class="card mt-6">
                    <h3>Exporter</h3>
                    <p class="export-desc">T√©l√©chargez vos donn√©es dans diff√©rents formats</p>
                    <div class="export-buttons">
                        <button class="btn btn-outline" style="width: 100%;" (click)="exportCSV()">
                            üìä Exporter en CSV
                        </button>
                        <button class="btn btn-outline" style="width: 100%;" (click)="exportPDF()">
                            üìÑ Exporter en PDF
                        </button>
                        <button class="btn btn-outline" style="width: 100%;" (click)="exportExcel()">
                            üìà Exporter en Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<app-footer></app-footer>
<div>
    <!-- Add Guest Modal -->
    <app-add-guest-modal
        *ngIf="showAddGuestModal()"
        (guestAdded)="onGuestAdded($event)"
        (closed)="closeAddGuestModal()"
    ></app-add-guest-modal>

    <app-error-modal
        [visible]="showErrorModal"
        [message]="errorMessage"
        (closed)="closeErrorModal()">
    </app-error-modal>

    <!-- Import Guests Modal -->
    <app-import-guests-modal
        *ngIf="showImportModal()"
        (refresh)="getGuestsByEvent()"
        (closed)="closeImportModal()"
    ></app-import-guests-modal>

    <!-- Modal de confirmation -->
    <app-confirm-delete-modal
        [visible]="showDeleteModal"
        [message] = warningMessage
        [action]="modalAction"
        (confirmDelete)="confirmDelete()"
        (cancel)="closeModal()">
    </app-confirm-delete-modal>

    <!-- Indicateur de chargement -->
    <app-spinner [isLoading]="isLoading"></app-spinner>
</div>