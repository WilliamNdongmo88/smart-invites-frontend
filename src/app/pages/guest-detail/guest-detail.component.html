<div class="guest-detail">
    <!-- Indicateur de chargement -->
    <app-spinner [isLoading]="isLoading"></app-spinner>
    
    <!-- Header -->
    <div class="guest-detail-header">
    <div class="container">
        <a (click)="backToGuestList()" class="back-link">â† Retour Ã  la liste des invitÃ©s</a>
        <div class="header-content">
        <div class="guest-avatar-large">
            {{ guest.name.charAt(0).toUpperCase() }}
        </div>
        <div class="guest-header-info">
            <h1>{{ guest.name }}</h1>
            <p class="email">{{ guest.email }}</p>
            <span class="status-badge large" [class]="'status-' + guest.status">
            {{ getStatusIcon(guest.status) }} {{ getStatusLabel(guest.status) }}
            </span>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline" (click)="editGuest()">âœï¸ Ã‰diter</button>
            <button class="btn btn-outline btn-danger" (click)="openDeleteModal('delete')">ğŸ—‘ï¸ Supprimer</button>
        </div>
        </div>
    </div>
    </div>

    <!-- Main content -->
    <div class="container py-12">
    <div class="grid grid-detail">
        <!-- Left column - Guest Information -->
        <div class="left-column">
        <!-- Personal Information -->
        <div class="card">
            <h2>Informations personnelles</h2>

            <div class="info-section">
            <div class="info-row">
                <span class="label">ğŸ“§ Email</span>
                <span class="value">{{ guest.email }}</span>
            </div>

            <div class="info-row" *ngIf="guest.phone">
                <span class="label">ğŸ“± TÃ©lÃ©phone</span>
                <span class="value">{{ guest.phone }}</span>
            </div>

            <div class="info-row" *ngIf="guest.invitationSentDate">
                <span class="label">ğŸ“¬ Invitation envoyÃ©e</span>
                <span class="value">{{ formatDate(guest.invitationSentDate) }}</span>
            </div>
            </div>

            <div class="divider-gold"></div>

            <button class="btn btn-primary" style="width: 100%;" (click)="resendInvitation()">
                {{ loading ? 'â³ Renvoie en cours ...' : 'âœ‰ï¸ Renvoyer invitation'}}
            </button>
        </div>

        <!-- Event Response -->
        <div class="card mt-8">
            <h2>RÃ©ponse Ã  l'Ã©vÃ©nement</h2>

            <div class="status-detail">
            <div class="status-icon" [class]="'status-' + guest.status">
                {{ getStatusIcon(guest.status) }}
            </div>
            <div class="status-info">
                <p class="status-title">{{ getStatusLabel(guest.status) }}</p>
                <p class="status-date" *ngIf="guest.responseDate">
                RÃ©pondu le {{ formatDate(guest.responseDate) }} Ã  {{ guest.responseTime }}
                </p>
                <p class="status-date" *ngIf="!guest.responseDate">
                En attente de rÃ©ponse
                </p>
            </div>
            </div>

            <div class="divider-gold"></div>

            <div class="action-buttons">
            <button class="btn btn-outline" (click)="markAsPending()">
                {{ loading ? 'â³ Changement en cours ...' : 'Marquer attente'}}
            </button>
            <button class="btn btn-outline" (click)="markAsConfirmed()">
                {{ loading ? 'â³ Changement en cours ...' : 'âœ“ Marquer confirmÃ©'}}
            </button>
            <button class="btn btn-outline" (click)="markAsDeclined()">
                {{ loading ? 'â³ Changement en cours ...' : 'âœ• Marquer refusÃ©'}}
            </button>
            </div>
        </div>

        <!-- Dietary Restrictions & Options -->
        <div class="card mt-8">
            <h2>Options et restrictions</h2>

            <div class="options-list">
            <div class="option-item" *ngIf="guest.dietaryRestrictions">
                <span class="option-label">ğŸ½ï¸ Restrictions alimentaires</span>
                <span class="option-value">{{ guest.dietaryRestrictions }}</span>
            </div>

            <div class="option-item">
                <span class="option-label">ğŸ‘¥ +1 autorisÃ©</span>
                <span class="option-value">{{ guest.plusOne ? 'Oui' : 'Non' }}</span>
            </div>
            </div>

            <div class="divider-gold"></div>

            <button class="btn btn-outline" style="width: 100%;" (click)="editOptions()">
            âœï¸ Modifier les options
            </button>
        </div>

        <!-- Notes -->
        <div class="card mt-8">
            <h2>Notes</h2>

            <div class="notes-box">
            <p *ngIf="guest.notes">{{ guest.notes }}</p>
            <p *ngIf="!guest.notes" class="no-notes">Aucune note</p>
            </div>

            <button class="btn btn-outline" style="width: 100%;" (click)="addNotes()">
            ğŸ“ Ajouter une note
            </button>
        </div>
        </div>

        <!-- Right column - QR Code & Actions -->
        <div class="right-column">
        <!-- QR Code Section -->
        <div class="card">
            <h2>Code QR</h2>

            <div *ngIf="guest.qrCodeGenerated" class="qr-code-section">
            <div class="qr-code-container">
                <img
                [src]="guest.qrCodeUrl"
                alt="QR Code"
                class="qr-code-image"
                />
            </div>
            <p class="qr-description">
                Scannez ce code pour accÃ©der Ã  l'invitation
            </p>

            <div class="qr-actions">
                <button class="btn btn-outline" style="width: 100%;" (click)="downloadQRCode()">
                ğŸ“¥ TÃ©lÃ©charger
                </button>
                <button class="btn btn-outline" style="width: 100%;" (click)="printQRCode()">
                ğŸ–¨ï¸ Imprimer
                </button>
            </div>
            </div>

            <div *ngIf="!guest.qrCodeGenerated" class="no-qr-section">
            <div class="no-qr-icon">ğŸ“±</div>
            <p>Aucun code QR gÃ©nÃ©rÃ©</p>
            <button class="btn btn-primary" style="width: 100%;" (click)="generateQRCode()">
                {{loading ? 'â³ Envoie en cours ...' :'âœ¨ Envoyer une invitation'}}
            </button>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mt-6">
            <h2>Actions rapides</h2>

            <div class="actions-list">
            <button class="action-btn" (click)="sendMessage()">
                <span class="icon">ğŸ’¬</span>
                <span class="text">Envoyer un message</span>
            </button>

            <button class="action-btn" (click)="callGuest()">
                <span class="icon">ğŸ“</span>
                <span class="text">Appeler</span>
            </button>

            <button class="action-btn" (click)="sendEmail()">
                <span class="icon">âœ‰ï¸</span>
                <span class="text">Envoyer un email</span>
            </button>

            <button class="action-btn" (click)="shareInvitation()">
                <span class="icon">ğŸ”—</span>
                <span class="text">Partager l'invitation</span>
            </button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="card mt-6">
            <h2>Statistiques</h2>

            <div class="stats-list">
            <div class="stat-item">
                <span class="stat-label">Statut</span>
                <span class="stat-value" [class]="'status-' + guest.status">
                {{ getStatusLabel(guest.status) }}
                </span>
            </div>

            <div class="stat-item">
                <span class="stat-label">InvitÃ© depuis</span>
                <span class="stat-value">{{ daysAgo(guest.invitationSentDate) }} jours</span>
            </div>

            <div class="stat-item" *ngIf="guest.responseDate">
                <span class="stat-label">Temps de rÃ©ponse</span>
                <span class="stat-value">{{ daysBetween(guest.invitationSentDate, guest.responseDate) }} jours</span>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
</div>

<!-- Modal de confirmation -->
<app-confirm-delete-modal
    [visible]="showDeleteModal"
    [message] = warningMessage
    [action]="modalAction"
    (confirmDelete)="confirmDelete()"
    (cancel)="closeModal()">
</app-confirm-delete-modal>