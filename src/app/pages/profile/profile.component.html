<div class="profile-page">
    <!-- Header -->
    <div class="profile-header">
    <div class="container">
        <a routerLink="/evenements" class="back-link">‚Üê Retour</a>
        <h1>Mon Profil</h1>
    </div>
    </div>

    <!-- Main content -->
    <div class="container py-12">
    <div class="profile-wrapper">
        <!-- Sidebar -->
        <div class="profile-sidebar">
        <div class="profile-card">
            <div class="avatar-section">
            <img *ngIf="userProfile.avatar == null" [src]="'img/avatar.webp'" alt="Avatar" class="avatar" />
            <img *ngIf="userProfile.avatar != null" [src]="userProfile.avatar" alt="Avatar" class="avatar" />
            <button class="btn-change-avatar">üì∑ Changer</button>
            </div>

            <h2>{{ userProfile.fullName }}</h2>
            <p class="email">{{ userProfile.email }}</p>

            <!-- <div class="profile-stats">
            <div class="stat">
                <span class="stat-value">12</span>
                <span class="stat-label">√âv√©nements</span>
            </div>
            <div class="stat">
                <span class="stat-value">45</span>
                <span class="stat-label">Invitations</span>
            </div>
            <div class="stat">
                <span class="stat-value">38</span>
                <span class="stat-label">Confirm√©es</span>
            </div>
            </div> -->

            <!-- <button class="btn btn-outline" style="width: 100%;">
            üîó Copier le lien de profil
            </button> -->
        </div>

        <!-- Menu de navigation -->
        <div class="profile-menu">
            <button
            *ngFor="let tab of tabs"
            [class.active]="activeTab === tab.id"
            (click)="activeTab = tab.id"
            class="menu-item"
            >
            {{ tab.icon }} {{ tab.label }}
            </button>
        </div>
        </div>

        <!-- Main content area -->
        <div class="profile-content">
        <!-- Tab: Informations personnelles -->
        <div *ngIf="activeTab === 'personal'" class="tab-content">
            <div class="content-card">
                <h2>Informations Personnelles</h2>

                <form #profileForm="ngForm" (ngSubmit)="saveProfile()" novalidate>
                    <div class="form-grid">

                        <!-- Nom complet -->
                        <div class="form-group full-width">
                        <label>Nom complet *</label>
                        <input
                            type="text"
                            name="fullName"
                            [(ngModel)]="userProfile.fullName"
                            required
                            minlength="3"
                            class="form-input"
                        />
                        <small class="error"
                            *ngIf="profileForm.submitted && profileForm.controls['fullName']?.invalid">
                            Nom requis (min. 3 caract√®res)
                        </small>
                        </div>

                        <!-- <div class="form-group">
                        <label>Pr√©nom *</label>
                        <input type="text" [(ngModel)]="userProfile.firstName" class="form-input" />
                        </div>

                        <div class="form-group">
                        <label>Nom *</label>
                        <input type="text" [(ngModel)]="userProfile.lastName" class="form-input" />
                        </div> -->

                        <!-- Email -->
                        <div class="form-group">
                        <label>Email *</label>
                        <input
                            type="email"
                            name="email"
                            [(ngModel)]="userProfile.email"
                            required
                            email
                            class="form-input"
                        />
                        <small class="error"
                            *ngIf="profileForm.submitted && profileForm.controls['email']?.invalid">
                            Email invalide
                        </small>
                        </div>

                        <!-- T√©l√©phone -->
                        <div class="form-group">
                        <label>T√©l√©phone</label>
                        <input
                            type="tel"
                            name="phone"
                            [(ngModel)]="userProfile.phone"
                            pattern="^[0-9+ ]*$"
                            class="form-input"
                        />
                        </div>

                        <!-- <div class="form-group">
                        <label>Date de naissance</label>
                        <input type="date" [(ngModel)]="userProfile.birthDate" class="form-input" />
                        </div>

                        <div class="form-group">
                        <label>Genre</label>
                        <select [(ngModel)]="userProfile.gender" class="form-select">
                            <option value="">Non sp√©cifi√©</option>
                            <option value="male">Homme</option>
                            <option value="female">Femme</option>
                            <option value="other">Autre</option>
                        </select>
                        </div> -->

                        <!-- Bio -->
                        <div class="form-group full-width">
                        <label>Bio</label>
                        <textarea
                            name="bio"
                            [(ngModel)]="userProfile.bio"
                            rows="4"
                            class="form-textarea"
                            placeholder="Parlez-nous de vous...">
                        </textarea>
                        </div>

                        <!-- <div class="form-group">
                        <label>Localisation</label>
                        <input type="text" [(ngModel)]="userProfile.location" class="form-input" placeholder="Ville, Pays" />
                        </div>

                        <div class="form-group">
                        <label>Site web</label>
                        <input type="url" [(ngModel)]="userProfile.website" class="form-input" placeholder="https://..." />
                        </div>

                        <div class="form-group">
                        <label>Langue</label>
                        <select [(ngModel)]="userProfile.language" class="form-select">
                            <option value="fr">Fran√ßais</option>
                            <option value="en">Anglais</option>
                            <option value="es">Espagnol</option>
                            <option value="de">Allemand</option>
                        </select>
                        </div>

                        <div class="form-group">
                        <label>Fuseau horaire</label>
                        <select [(ngModel)]="userProfile.timezone" class="form-select">
                            <option value="Europe/Paris">Europe/Paris (GMT+1)</option>
                            <option value="Europe/London">Europe/London (GMT+0)</option>
                            <option value="America/New_York">America/New_York (GMT-5)</option>
                            <option value="America/Los_Angeles">America/Los_Angeles (GMT-8)</option>
                        </select>
                        </div> -->
                    </div>

                    <!-- Actions -->
                    <div class="form-actions">
                        <button
                        type="submit"
                        class="btn btn-primary"
                        [disabled]="profileForm.invalid || loading">
                        {{ loading ? '‚è≥ Enregistrement...' : 'üíæ Enregistrer les modifications' }}
                        </button>

                        <button
                        type="button"
                        class="btn btn-outline"
                        (click)="resetForm(profileForm)">
                        ‚Ü∫ Annuler
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab: S√©curit√© -->
        <div *ngIf="activeTab === 'security'" class="tab-content">
            <div class="content-card">
            <h2>S√©curit√© et Mot de Passe</h2>

            <form
                #passwordForm="ngForm"
                (ngSubmit)="changePassword(passwordForm)"
                novalidate
                class="security-section"
            >
                <h3>Changer le mot de passe</h3>

                <!-- Mot de passe actuel -->
                <div class="form-group">
                    <label for="currentPassword">Mot de passe actuel *</label>
                    <input
                        type="password"
                        id="currentPassword"
                        name="currentPassword"
                        [(ngModel)]="passwordData.currentPassword"
                        #currentPasswordRef="ngModel"
                        required
                        minlength="6"
                        class="form-input"
                    />
                    <!-- Messages d'erreur pour le mot de passe actuel -->
                    <div *ngIf="currentPasswordRef.invalid && (currentPasswordRef.dirty || currentPasswordRef.touched)" class="error-message">
                        <p *ngIf="currentPasswordRef.errors?.['required']">Le mot de passe actuel est requis.</p>
                        <p *ngIf="currentPasswordRef.errors?.['minlength']">Le mot de passe actuel doit contenir au moins 6 caract√®res.</p>
                    </div>
                </div>

                <!-- Nouveau mot de passe -->
                <div class="form-group">
                    <label for="newPassword">Nouveau mot de passe *</label>
                    <input
                        type="password"
                        id="newPassword"
                        name="newPassword"
                        [(ngModel)]="passwordData.newPassword"
                        #newPasswordRef="ngModel"
                        required
                        minlength="8"
                        class="form-input"
                    />
                    <!-- Messages d'erreur pour le nouveau mot de passe -->
                    <div *ngIf="newPasswordRef.invalid && (newPasswordRef.dirty || newPasswordRef.touched)" class="error-message">
                        <p *ngIf="newPasswordRef.errors?.['required']">Le nouveau mot de passe est requis.</p>
                        <p *ngIf="newPasswordRef.errors?.['minlength']">Le nouveau mot de passe doit contenir au moins 8 caract√®res.</p>
                    </div>
                </div>

                <!-- Confirmation -->
                <div class="form-group">
                    <label for="confirmPassword">Confirmer le mot de passe *</label>
                    <input
                        type="password"
                        id="confirmPassword"
                        name="confirmPassword"
                        [(ngModel)]="passwordData.confirmPassword"
                        #confirmPasswordRef="ngModel"
                        required
                        minlength="8"
                        class="form-input"
                    />
                    <!-- Messages d'erreur pour la confirmation du mot de passe -->
                    <div *ngIf="confirmPasswordRef.invalid && (confirmPasswordRef.dirty || confirmPasswordRef.touched)" class="error-message">
                        <p *ngIf="confirmPasswordRef.errors?.['required']">La confirmation du mot de passe est requise.</p>
                        <p *ngIf="confirmPasswordRef.errors?.['minlength']">La confirmation doit contenir au moins 8 caract√®res.</p>
                    </div>
                    <!-- Message d'erreur pour la non-correspondance des mots de passe -->
                    <div *ngIf="passwordData.newPassword !== passwordData.confirmPassword && confirmPasswordRef.dirty && confirmPasswordRef.valid" class="error-message">
                        <p>Les mots de passe ne correspondent pas.</p>
                    </div>
                </div>

                <!-- Bouton [disabled]="loading" -->
                <button
                    type="submit"
                    class="btn btn-primary btn-mt"
                    
                >
                    {{ loading ? '‚è≥ Modification...' : 'üîí Changer le mot de passe' }}
                </button>
                <div class="password-reset">
                    <p>Mot de passe actuel oubli√© ?</p>
                    <a (click)="goToResetPage()" class="pass-link">Reset mon mot de passe</a>
                </div>
                <!-- Success backend -->
                <p class="success" *ngIf="successMessage">
                    {{ successMessage }}
                </p>
                <!-- Erreur backend -->
                <p class="error" *ngIf="errorMessage">
                    {{ errorMessage }}
                </p>
            </form>

            <!-- <div class="security-section">
                <h3>Authentification √† deux facteurs</h3>
                <p>Renforcez la s√©curit√© de votre compte avec l'authentification √† deux facteurs.</p>
                <button class="btn btn-outline">üîê Activer l'authentification 2FA</button>
            </div>

            <div class="security-section">
                <h3>Sessions actives</h3>
                <div class="session-item">
                <div class="session-info">
                    <p class="session-device">üíª Chrome sur Windows</p>
                    <p class="session-location">Paris, France</p>
                    <p class="session-date">Connect√© il y a 2 heures</p>
                </div>
                <button class="btn-small">D√©connecter</button>
                </div>

                <div class="session-item">
                <div class="session-info">
                    <p class="session-device">üì± Safari sur iPhone</p>
                    <p class="session-location">Lyon, France</p>
                    <p class="session-date">Connect√© il y a 1 jour</p>
                </div>
                <button class="btn-small">D√©connecter</button>
                </div>

                <button class="btn btn-outline" style="width: 100%; margin-top: 1rem;">
                üö™ D√©connecter de tous les appareils
                </button>
            </div> -->
            </div>
        </div>

        <!-- Tab: Notifications -->
        <div *ngIf="activeTab === 'notifications'" class="tab-content">
            <div class="content-card">
            <h2>Pr√©f√©rences de Notifications</h2>

            <div class="notification-section">
                <h3>Canaux de notification</h3>

                <div class="notification-item">
                <div class="notification-info">
                    <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="notificationPrefs.emailNotifications" />
                    <span>üìß Notifications par email</span>
                    </label>
                    <p class="description">Recevoir les notifications par email</p>
                </div>
                </div>

                <!-- <div class="notification-item">
                <div class="notification-info">
                    <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="notificationPrefs.smsNotifications" />
                    <span>üì± Notifications par SMS</span>
                    </label>
                    <p class="description">Recevoir les notifications par SMS</p>
                </div>
                </div> -->

                <!-- <div class="notification-item">
                <div class="notification-info">
                    <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="notificationPrefs.pushNotifications" />
                    <span>üîî Notifications push</span>
                    </label>
                    <p class="description">Recevoir les notifications push sur votre navigateur</p>
                </div>
                </div> -->
            </div>

            <div class="notification-section">
                <h3>Types de notifications</h3>

                <div class="notification-item">
                <div class="notification-info">
                    <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="notificationPrefs.eventReminders" />
                    <span>üìÖ Rappels d'√©v√©nements</span>
                    </label>
                    <p class="description">Rappels 2 jours avant les √©v√©nements pr√©vus</p>
                </div>
                </div>

                <div class="notification-item">
                    <div class="notification-info">
                        <label class="checkbox-label">
                        <input type="checkbox" [(ngModel)]="notificationPrefs.attendanceNotifications" />
                        <span>üì• R√©capitulatif de pr√©sence</span>
                        </label>
                        <p class="description">Recevoir la liste de tous les invit√©s pr√©sents et absents lors de l‚Äô√©v√©nement.</p>
                    </div>
                </div>

                <div class="notification-item">
                    <div class="notification-info">
                        <label class="checkbox-label">
                        <input type="checkbox" [(ngModel)]="notificationPrefs.thankNotifications" />
                        <span>üìã Email de remerciement</span>
                        </label>
                        <p class="description">Envoyer automatiquement un email de remerciement √† tous les invit√©s pr√©sents √† l'√©v√©nement</p>
                    </div>
                </div>

                <div class="notification-item">
                <div class="notification-info">
                    <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="notificationPrefs.marketingEmails" />
                    <span>üéØ Emails marketing</span>
                    </label>
                    <p class="description">Recevoir les actualit√©s et offres de Smart Invite</p>
                </div>
                </div>
            </div>

            <button class="btn btn-primary" (click)="saveProfile()">
                {{ loading ? '‚è≥ Enregistrement...' : 'üíæ Enregistrer les pr√©f√©rences' }}
            </button>
            </div>
        </div>

        <!-- Tab: Confidentialit√© -->
        <!-- <div *ngIf="activeTab === 'privacy'" class="tab-content">
            <div class="content-card">
            <h2>Confidentialit√© et Partage</h2>

            <div class="privacy-section">
                <h3>Visibilit√© du profil</h3>
                <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" [(ngModel)]="privacySettings.profileVisibility" value="public" />
                    <span>üåê Public</span>
                    <p class="description">Votre profil est visible par tous</p>
                </label>
                </div>

                <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" [(ngModel)]="privacySettings.profileVisibility" value="friends" />
                    <span>üë• Amis uniquement</span>
                    <p class="description">Votre profil est visible par vos amis</p>
                </label>
                </div>

                <div class="radio-group">
                <label class="radio-label">
                    <input type="radio" [(ngModel)]="privacySettings.profileVisibility" value="private" />
                    <span>üîí Priv√©</span>
                    <p class="description">Votre profil n'est visible que par vous</p>
                </label>
                </div>
            </div>

            <div class="privacy-section">
                <h3>Informations visibles</h3>

                <div class="privacy-item">
                <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="privacySettings.showEmail" />
                    <span>Afficher mon email</span>
                </label>
                </div>

                <div class="privacy-item">
                <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="privacySettings.showPhone" />
                    <span>Afficher mon t√©l√©phone</span>
                </label>
                </div>
            </div>

            <div class="privacy-section">
                <h3>Interactions</h3>

                <div class="privacy-item">
                <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="privacySettings.allowMessages" />
                    <span>Permettre les messages priv√©s</span>
                </label>
                </div>

                <div class="privacy-item">
                <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="privacySettings.allowEventInvites" />
                    <span>Permettre les invitations d'√©v√©nements</span>
                </label>
                </div>
            </div>

            <button class="btn btn-primary">üíæ Enregistrer les param√®tres</button>
            </div>
        </div> -->

        <!-- Tab: Compte -->
        <div *ngIf="activeTab === 'account'" class="tab-content">
            <div class="content-card">
            <h2>Param√®tres du Compte</h2>

            <div class="account-section">
                <h3>Informations du compte</h3>
                <div class="info-item">
                <span class="label">ID utilisateur</span>
                <span class="value">{{ userProfile.id }}</span>
                </div>
                <div class="info-item">
                <span class="label">Email</span>
                <span class="value">{{ userProfile.email }}</span>
                </div>
                <div class="info-item">
                <span class="label">Compte cr√©√©</span>
                <span class="value">{{ formatDate(userProfile.createdAt) }}</span>
                </div>
            </div>

            <!-- <div class="account-section">
                <h3>T√©l√©charger vos donn√©es</h3>
                <p>T√©l√©chargez une copie de toutes vos donn√©es personnelles.</p>
                <button class="btn btn-outline">üì• T√©l√©charger mes donn√©es</button>
            </div> -->

            <div class="account-section danger">
                <h3>Zone de danger</h3>
                <p>Actions irr√©versibles sur votre compte.</p>

                <button class="btn btn-outline danger" (click)="openDeleteModal('delete')">
                    {{ loading ? '‚è≥ Suppr√©ssion...' : 'üóëÔ∏è Supprimer mon compte' }}
                </button>
            </div>
            </div>
        </div>
        </div>
    </div>
    </div>
</div>

<app-confirm-delete-modal
    [visible]="showDeleteModal"
    [message] = warningMessage
    [action]="modalAction"
    (confirmDelete)="confirmDelete()"
    (cancel)="closeModal()">
</app-confirm-delete-modal>